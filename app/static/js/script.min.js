var qry={video:"",container:"",canvas:"",ctx:"",out:"",found:!1,timer:"",loop:function(){qry.captureToCanvas();qry.found?(qry.timer&&clearTimeout(qry.timer),qry.out.className="happy",/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/.test(qry.found)?qry.out.innerHTML="<span>Links are not allowed</span>":document.getElementById("deviceID").value=qry.found,qry.canvas.style.height=qry.video.clientHeight+"px",qry.container.removeChild(qry.video),qry.container.appendChild(qry.canvas)):
(qry.out.className="",qry.out.innerHTML="scan your code",qry.timer=setTimeout(qry.loop,250))},captureToCanvas:function(){qry.ctx.drawImage(qry.video,0,0,qry.video.videoWidth,qry.video.videoHeight,0,0,qry.canvas.width,qry.canvas.height);qrcode.decode(qry.canvas.toDataURL())},canvasInit:function(){qry.canvas=document.createElement("canvas");qry.canvas.width=qry.video.videoWidth;qry.canvas.height=qry.video.videoHeight;qry.ctx=qry.canvas.getContext("2d");qry.timer=setTimeout(qry.loop,250)},init:function(){qry.video=
document.getElementById("sourcevid");qry.container=qry.video.parentNode;qry.out=document.getElementById("out");navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL||window.mozURL||window.msURL;navigator.getUserMedia?(navigator.getUserMedia({video:!0},function(a){qry.video.mozCaptureStream?qry.video.mozSrcObject=a:qry.video.src=window.URL&&window.URL.createObjectURL(a)||a;qry.video.addEventListener("loadedmetadata",
function(){qry.video.play();qry.canvasInit()},!1)},function(a){qry.out.className="sad";qry.out.innerHTML="an error occurred"}),qrcode.callback=function(a){qry.found=a}):(qry.out.className="sad",qry.out.innerHTML="no <code>getUserMedia</code> support")}};window.addEventListener("load",qry.init,!0);
